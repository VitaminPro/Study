# SQL и PostgreSQL для .NET-разработчика - Тест из 40 вопросов

## 1. Основы подключения к PostgreSQL

В .NET для работы с PostgreSQL используется библиотека Npgsql. При создании подключения важно понимать правильный формат строки подключения и параметры конфигурации.

**Вопрос:** Какая из строк подключения к PostgreSQL является корректной для Npgsql?

1. `Server=localhost;Database=mydb;Username=user;Password=pass;`
2. `Data Source=localhost;Initial Catalog=mydb;User ID=user;Password=pass;`
✅ 3. `Host=localhost;Database=mydb;Username=user;Password=pass;`
4. `ConnectionString=localhost;DB=mydb;Login=user;Pwd=pass;`

## 2. Транзакции и изоляция

PostgreSQL поддерживает различные уровни изоляции транзакций. Понимание этих уровней критично для обеспечения целостности данных в многопользовательской среде.

**Вопрос:** Какой уровень изоляции транзакций в PostgreSQL по умолчанию?

1. Read Uncommitted
✅ 2. Read Committed
3. Repeatable Read
4. Serializable

## 3. Работа с NULL значениями

В SQL операции с NULL имеют особую логику. При сравнении с NULL результат всегда неопределен, что важно учитывать при написании запросов.

**Вопрос:** Что вернет запрос `SELECT COUNT(*) FROM users WHERE age <> NULL;`?

✅ 1. 0
2. Количество записей где age не равно NULL
3. Общее количество записей в таблице
4. Ошибку

## 4. Индексы в PostgreSQL

Индексы критично важны для производительности запросов. PostgreSQL поддерживает различные типы индексов: B-tree, Hash, GiST, SP-GiST, GIN и BRIN.

**Вопрос:** Какой тип индекса в PostgreSQL наиболее эффективен для полнотекстового поиска?

1. B-tree
2. Hash
✅ 3. GIN
4. BRIN

## 5. Npgsql и параметризованные запросы

Параметризованные запросы защищают от SQL-инъекций и повышают производительность за счет переиспользования планов выполнения.

**Вопрос:** Какой синтаксис правильный для параметризованного запроса в Npgsql?

1. `SELECT * FROM users WHERE id = {0}`
✅ 2. `SELECT * FROM users WHERE id = @userId`
3. `SELECT * FROM users WHERE id = ?`
4. `SELECT * FROM users WHERE id = :userId`

## 6. JSONB в PostgreSQL

PostgreSQL предоставляет мощные возможности для работы с JSON данными через тип JSONB, который хранит данные в бинарном формате для быстрого доступа.

**Вопрос:** Какой оператор используется в PostgreSQL для проверки существования ключа в JSONB?

1. ->
2. ->>
✅ 3. ?
4. @>

## 7. Оконные функции

Оконные функции позволяют выполнять вычисления над набором строк, связанных с текущей строкой, без необходимости группировки данных.

**Вопрос:** Что делает следующий запрос: `SELECT name, salary, ROW_NUMBER() OVER (ORDER BY salary DESC) FROM employees`?

1. Группирует сотрудников по зарплате
✅ 2. Присваивает номер строки каждому сотруднику в порядке убывания зарплаты
3. Подсчитывает количество сотрудников с одинаковой зарплатой
4. Сортирует сотрудников по имени

## 8. Команды DDL и транзакции

В PostgreSQL большинство DDL команд могут выполняться внутри транзакций, что отличает его от многих других СУБД.

**Вопрос:** Можно ли в PostgreSQL откатить CREATE TABLE внутри транзакции?

✅ 1. Да, можно
2. Нет, нельзя
3. Только если таблица пустая
4. Только с специальным флагом

## 9. Конфликты при INSERT

PostgreSQL предоставляет механизм ON CONFLICT для элегантной обработки нарушений уникальности при вставке данных.

**Вопрос:** Какая конструкция позволяет игнорировать дублирующиеся записи при INSERT в PostgreSQL?

1. INSERT IGNORE
2. INSERT OR IGNORE
✅ 3. INSERT ... ON CONFLICT DO NOTHING
4. INSERT ... WHEN NOT EXISTS

## 10. Типы соединений

Различные типы JOIN'ов позволяют комбинировать данные из нескольких таблиц разными способами в зависимости от бизнес-логики.

**Вопрос:** Какой тип JOIN вернет все записи из левой таблицы, даже если нет соответствий в правой?

✅ 1. LEFT JOIN
2. RIGHT JOIN  
3. INNER JOIN
4. FULL OUTER JOIN

## 11. Последовательности (SERIAL)

В PostgreSQL для автоинкремента используются последовательности, которые могут быть созданы автоматически через SERIAL или вручную.

**Вопрос:** Что происходит с последовательностью при удалении всех записей из таблицы командой DELETE?

1. Сбрасывается на 1
✅ 2. Продолжает с последнего значения
3. Удаляется автоматически
4. Блокируется до перезапуска

## 12. Производительность запросов

EXPLAIN ANALYZE показывает не только план выполнения запроса, но и фактические метрики времени выполнения и использования ресурсов.

**Вопрос:** Какая команда показывает фактическое время выполнения запроса в PostgreSQL?

1. EXPLAIN
✅ 2. EXPLAIN ANALYZE
3. SHOW QUERY
4. PROFILE QUERY

## 13. Ограничения (Constraints)

Ограничения обеспечивают целостность данных на уровне базы данных. CHECK ограничения позволяют задавать произвольные условия для значений.

**Вопрос:** Какое ограничение проверяет, что возраст сотрудника больше 18 лет?

1. `CONSTRAINT age_limit UNIQUE (age > 18)`
✅ 2. `CONSTRAINT age_limit CHECK (age > 18)`
3. `CONSTRAINT age_limit FOREIGN KEY (age > 18)`
4. `CONSTRAINT age_limit PRIMARY KEY (age > 18)`

## 14. Работа с датами

PostgreSQL предоставляет богатую функциональность для работы с датами и временем, включая арифметические операции и извлечение частей даты.

**Вопрос:** Какая функция извлекает год из даты в PostgreSQL?

1. YEAR(date)
2. GET_YEAR(date)
✅ 3. EXTRACT(YEAR FROM date)
4. DATE_YEAR(date)

## 15. Группировка и агрегация

HAVING фильтрует группы после применения GROUP BY, в отличие от WHERE, который фильтрует строки до группировки.

**Вопрос:** В чем разница между WHERE и HAVING в запросах с GROUP BY?

1. Никакой разницы нет
✅ 2. WHERE фильтрует строки до группировки, HAVING - группы после
3. WHERE быстрее HAVING
4. HAVING можно использовать только с COUNT

## 16. Entity Framework и PostgreSQL

При использовании Entity Framework с PostgreSQL важно правильно настроить провайдер и учитывать особенности PostgreSQL при маппинге типов данных.

**Вопрос:** Какой NuGet пакет нужен для использования PostgreSQL с Entity Framework Core?

1. Microsoft.EntityFrameworkCore.PostgreSQL
2. EntityFramework.PostgreSQL
✅ 3. Npgsql.EntityFrameworkCore.PostgreSQL
4. PostgreSQL.EntityFrameworkCore

## 17. Массивы в PostgreSQL

PostgreSQL нативно поддерживает массивы, что позволяет хранить множественные значения в одном поле и выполнять операции над ними.

**Вопрос:** Как создать столбец с массивом целых чисел в PostgreSQL?

1. `numbers INTEGER[]`
✅ 2. `numbers INTEGER[]`
3. `numbers ARRAY<INTEGER>`
4. `numbers INTEGER ARRAY`

## 18. Блокировки и конкурентность

PostgreSQL использует MVCC (Multi-Version Concurrency Control) для обеспечения конкурентного доступа к данным без блокировок на чтение.

**Вопрос:** Что такое MVCC в PostgreSQL?

✅ 1. Механизм управления версиями для обеспечения конкурентности
2. Система резервного копирования
3. Тип индекса
4. Алгоритм сжатия данных

## 19. Функции и процедуры

PostgreSQL поддерживает создание пользовательских функций на различных языках, включая PL/pgSQL, который является процедурным расширением SQL.

**Вопрос:** На каком языке по умолчанию пишутся хранимые процедуры в PostgreSQL?

1. SQL
✅ 2. PL/pgSQL
3. JavaScript
4. C#

## 20. Репликация и масштабирование

PostgreSQL поддерживает различные типы репликации для обеспечения высокой доступности и масштабирования чтения.

**Вопрос:** Какой тип репликации в PostgreSQL позволяет читать данные с реплики?

1. Синхронная репликация
✅ 2. Hot Standby
3. Потоковая репликация
4. Логическая репликация

## 21. Подзапросы и CTE

Common Table Expressions (CTE) предоставляют способ создания именованных подзапросов, которые можно использовать в основном запросе.

**Вопрос:** Какое ключевое слово используется для создания CTE в PostgreSQL?

1. SUBQUERY
✅ 2. WITH
3. AS
4. TEMPORARY

## 22. Партиционирование

Партиционирование позволяет разделить большие таблицы на более мелкие части для улучшения производительности и управляемости.

**Вопрос:** Какой тип партиционирования доступен в PostgreSQL 10+?

1. Только по хешу
✅ 2. По диапазону, списку и хешу
3. Только по диапазону
4. Партиционирование не поддерживается

## 23. Типы данных

PostgreSQL предоставляет богатый набор встроенных типов данных, включая специфические типы для различных задач.

**Вопрос:** Какой тип данных в PostgreSQL используется для хранения IP-адресов?

1. VARCHAR
2. BINARY
✅ 3. INET
4. IPADDRESS

## 24. Полнотекстовый поиск

PostgreSQL имеет встроенную поддержку полнотекстового поиска с использованием специальных типов данных и операторов.

**Вопрос:** Какой тип данных используется для полнотекстового поиска в PostgreSQL?

1. TEXT
2. FULLTEXT
✅ 3. TSVECTOR
4. SEARCHABLE

## 25. Конфигурация подключений

Пул подключений критически важен для производительности приложений, работающих с базой данных.

**Вопрос:** Какой параметр в строке подключения Npgsql контролирует максимальное количество подключений в пуле?

1. Connection Pool Size
2. Pool Size
✅ 3. Maximum Pool Size
4. Max Connections

## 26. Триггеры

Триггеры в PostgreSQL могут выполняться до или после операций модификации данных и полезны для аудита, валидации и автоматических вычислений.

**Вопрос:** Когда выполняется BEFORE триггер?

✅ 1. До выполнения операции модификации
2. После выполнения операции модификации
3. Только при ошибках
4. В конце транзакции

## 27. Vacuum и обслуживание

VACUUM - это процесс очистки в PostgreSQL, который освобождает пространство от удаленных строк и обновляет статистику.

**Вопрос:** Для чего нужен VACUUM в PostgreSQL?

1. Для создания резервных копий
✅ 2. Для очистки пространства от удаленных строк
3. Для дефрагментации индексов
4. Для оптимизации запросов

## 28. Работа с enum

PostgreSQL поддерживает пользовательские enum типы, которые обеспечивают строгую типизацию для набора предопределенных значений.

**Вопрос:** Как создать enum тип в PostgreSQL?

1. `CREATE ENUM status AS ('active', 'inactive')`
✅ 2. `CREATE TYPE status AS ENUM ('active', 'inactive')`
3. `CREATE ENUM TYPE status ('active', 'inactive')`
4. `ENUM status VALUES ('active', 'inactive')`

## 29. Администрирование и права доступа

Система безопасности PostgreSQL основана на ролях, которые могут включать пользователей и группы с различными привилегиями.

**Вопрос:** Какая команда предоставляет право SELECT на таблицу пользователю в PostgreSQL?

1. `GIVE SELECT ON table TO user`
✅ 2. `GRANT SELECT ON table TO user`
3. `ALLOW SELECT ON table FOR user`
4. `PERMIT SELECT ON table TO user`

## 30. Логирование и мониторинг

PostgreSQL предоставляет обширные возможности логирования для мониторинга производительности и отладки.

**Вопрос:** Какой параметр конфигурации включает логирование медленных запросов?

1. slow_query_log
✅ 2. log_min_duration_statement
3. query_log_time
4. log_slow_queries

## 31. Работа с соединением в .NET

При работе с Npgsql важно правильно управлять жизненным циклом соединений и использовать асинхронные методы для избежания блокировок.

**Вопрос:** Какой метод рекомендуется для асинхронного выполнения запросов в Npgsql?

1. Execute()
2. Query()
✅ 3. ExecuteNonQueryAsync()
4. RunAsync()

## 32. Составные индексы

Порядок столбцов в составном индексе влияет на его эффективность для различных типов запросов.

**Вопрос:** В составном индексе `CREATE INDEX idx ON table (a, b, c)` какие запросы будут эффективно использовать индекс?

1. Только WHERE a = ? AND b = ? AND c = ?
✅ 2. WHERE a = ?, WHERE a = ? AND b = ?, WHERE a = ? AND b = ? AND c = ?
3. Любые запросы с этими столбцами
4. Только WHERE c = ?

## 33. Обработка исключений

При работе с PostgreSQL через .NET важно правильно обрабатывать специфические исключения PostgreSQL.

**Вопрос:** Какое исключение выбрасывает Npgsql при нарушении ограничения уникальности?

1. NpgsqlException с кодом ошибки
✅ 2. PostgresException с SqlState "23505"
3. UniqueConstraintException
4. DuplicateKeyException

## 34. Расширения PostgreSQL

PostgreSQL поддерживает множество расширений, которые добавляют дополнительную функциональность.

**Вопрос:** Какое расширение добавляет поддержку UUID в PostgreSQL?

1. uuid
2. guid-ossp
✅ 3. uuid-ossp
4. postgresql-uuid

## 35. Операторы сравнения

PostgreSQL предоставляет различные операторы для сравнения и поиска в текстовых полях.

**Вопрос:** Какой оператор используется для поиска по регулярному выражению в PostgreSQL?

1. REGEXP
2. REGEX
✅ 3. ~
4. MATCH

## 36. Работа с NULL и значениями по умолчанию

Функция COALESCE возвращает первое не-NULL значение из списка аргументов.

**Вопрос:** Что вернет `SELECT COALESCE(NULL, NULL, 'default', 'other')`?

1. NULL
2. 'other'
✅ 3. 'default'
4. Ошибку

## 37. Планировщик запросов

Планировщик запросов PostgreSQL анализирует различные способы выполнения запроса и выбирает наиболее эффективный.

**Вопрос:** Что показывает колонка "cost" в EXPLAIN?

1. Реальное время выполнения
✅ 2. Оценочную стоимость выполнения операции
3. Количество прочитанных строк
4. Использование памяти

## 38. Конкурентное обновление

При конкурентном обновлении данных важно понимать поведение различных операторов и уровней изоляции.

**Вопрос:** Что произойдет при одновременном UPDATE одной записи двумя транзакциями в PostgreSQL?

1. Обе транзакции выполнятся успешно
2. Произойдет взаимоблокировка (deadlock)
✅ 3. Одна транзакция будет ждать завершения другой
4. Обе транзакции откатятся

## 39. Резервное копирование

PostgreSQL предоставляет различные инструменты для создания резервных копий данных.

**Вопрос:** Какая утилита создает логический дамп базы данных PostgreSQL?

1. pg_backup
2. postgres_dump
✅ 3. pg_dump
4. pg_export

## 40. Оптимизация конфигурации

Правильная настройка параметров конфигурации PostgreSQL критически важна для производительности.

**Вопрос:** Какой параметр контролирует размер общей буферной памяти PostgreSQL?

1. buffer_pool_size
2. cache_size
✅ 3. shared_buffers
4. memory_buffer
